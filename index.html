<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 20px;
    }
    .subject, .variant, .question {
      padding: 15px;
      margin: 10px auto;
      width: 80%;
      background-color: #f0f0f0;
      border-radius: 8px;
      cursor: pointer;
    }
    .hidden { display: none; }
    button {
      padding: 10px 20px;
      margin: 5px 0;
      border: none;
      border-radius: 5px;
      background-color: #ddd;
      cursor: pointer;
      width: 60%;
    }
    button:hover {
      background-color: #ccc;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px 12px;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- –î–æ–±–∞–≤–ª–µ–Ω–æ -->
  
</head>
<body>
  <h1>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç</h1>
  <div id="subjectScreen"></div>
  <div id="variantScreen" class="hidden"></div>
  <div id="quizScreen" class="hidden"></div>
  <div id="resultScreen" class="hidden"></div>

  <script>
    const subjects = ["–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è", "–ò—Å—Ç–æ—Ä–∏—è", "–û—Å–Ω–æ–≤—ã –ø—Ä–∞–≤–∞"];
    const subjectScreen = document.getElementById("subjectScreen");
    const variantScreen = document.getElementById("variantScreen");
    const quizScreen = document.getElementById("quizScreen");
    const resultScreen = document.getElementById("resultScreen");

    let currentSubject = "";
    let currentVariant = "";
    let currentQuestions = [];
    let userAnswers = [];
    let currentQuestionIndex = 0;

    subjects.forEach(subj => {
      const div = document.createElement("div");
      div.className = "subject";
      div.innerText = subj;
      div.onclick = () => showVariants(subj);
      subjectScreen.appendChild(div);
    });

    function showVariants(subject) {
      currentSubject = subject;
      subjectScreen.classList.add("hidden");
      variantScreen.classList.remove("hidden");
      variantScreen.innerHTML = `<h2>${subject}: –í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç</h2>`;

      for (let i = 1; i <= 8; i++) {
        const div = document.createElement("div");
        div.className = "variant";
        div.innerText = `–í–∞—Ä–∏–∞–Ω—Ç ${i}`;
        div.onclick = () => loadTest(subject, i);
        variantScreen.appendChild(div);
      }
    }

    async function loadTest(subject, variantNumber) {
      currentVariant = variantNumber;
      variantScreen.classList.add("hidden");
      quizScreen.classList.remove("hidden");
      quizScreen.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞...";

      try {
        if (subject == "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞" && variantNumber == 1) {
          const res = await fetch('quiz_informatika_variant1.json');
          currentQuestions = await res.json();
        }
        else {
          currentQuestions = [
            {
              question: "–ó–∞–≥–ª—É—à–∫–∞: –°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?",
              options: ["3", "4", "5", "6"],
              answer: 1
            }
          ];
        }

        userAnswers = [];
        currentQuestionIndex = 0;
        showNextQuestion();
      } catch (error) {
        quizScreen.innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–∞.";
        console.error(error);
      }
    }

    function showNextQuestion() {
      quizScreen.innerHTML = "";
    
      const q = currentQuestions[currentQuestionIndex];
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `
        <h2>${currentSubject} ‚Äî –í–∞—Ä–∏–∞–Ω—Ç ${currentVariant}</h2>
        <p>${currentQuestionIndex + 1}) ${q.question}</p>
      `;
    
      q.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.innerText = option;
        btn.onclick = () => submitAnswer(index); // –ø–µ—Ä–µ–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å!
        btn.style.display = "block";
        btn.style.margin = "10px 0";
        div.appendChild(btn);
      });
    
      quizScreen.appendChild(div);
    }
    
    function submitAnswer(selectedIndex) {
      userAnswers.push(selectedIndex);
      currentQuestionIndex++;
    
      if (currentQuestionIndex < currentQuestions.length) {
        showNextQuestion();
      } else {
        showResults();
      }
    }


    
    function showResults() {
      quizScreen.classList.add("hidden");
      resultScreen.classList.remove("hidden");
      resultScreen.innerHTML = `<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>`;
    
      let score = 0;
      const table = document.createElement("table");
      table.innerHTML = `<tr><th>–í–æ–ø—Ä–æ—Å</th><th>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π</th><th>–¢—ã –≤—ã–±—Ä–∞–ª</th></tr>`;
    
      currentQuestions.forEach((q, i) => {
        const userIndex = userAnswers[i];
        const correctIndex = q.answer;
    
        const isCorrect = userIndex === correctIndex;
        if (isCorrect) score++;
    
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${q.question}</td>
          <td>${q.options[correctIndex]}</td>
          <td style="color: ${isCorrect ? 'green' : 'red'}">${q.options[userIndex]}</td>
        `;
        table.appendChild(row);
      });
    
      resultScreen.appendChild(table);
      resultScreen.innerHTML += `<p><strong>–¢—ã –Ω–∞–±—Ä–∞–ª: ${score} –∏–∑ ${currentQuestions.length}</strong></p>`;
      const btn = document.createElement("button");
      btn.innerText = "–í –º–µ–Ω—é";
      btn.onclick = () => location.reload();
      resultScreen.appendChild(btn);
    }

  </script>




  <!-- üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ Telegram ID -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const tg = window.Telegram.WebApp;
      tg.expand();
  
      const allowedUserIds = [1290894872, 886699157, 1769921919]; // üîÅ –ó–ê–ú–ï–ù–ò –°–Æ–î–ê —Å–≤–æ–∏ user.id
      const user = tg.initDataUnsafe && tg.initDataUnsafe.user;
  
      if (!user) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–∫—Ä—ã–ª —á–µ—Ä–µ–∑ Telegram WebApp
        document.body.innerHTML = `
          <div style="text-align:center;padding:40px;font-family:sans-serif">
            <h2>üö´ –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram</h2>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.</p>
          </div>
        `;
        return;
      }
  
      if (!allowedUserIds.includes(user.id)) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö
        document.body.innerHTML = `
          <div style="text-align:center;padding:40px;font-family:sans-serif">
            <h2>üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>
            <p>–í–∞—à Telegram ID: <b>${user.id}</b></p>
            <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
          </div>
        `;
        return;
      }
  
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à—ë–Ω ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
      console.log("‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–ª—è: " + user.username + " (ID: " + user.id + ")");
    });
  </script>
</body>
</html>
